<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Lawn Restoration Plan | Arlington Heights, IL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let app, db, auth, userId;
        let isAuthReady = false;
        let nutrientChartInstance;

        function getTodayDateString() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        document.addEventListener('DOMContentLoaded', async function() {
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            if (Object.keys(firebaseConfig).length > 0) {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        fetchAndDisplayTasks();
                    } else {
                        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                        try {
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                        } catch (error) {
                            console.error("Firebase Auth Error:", error);
                            userId = crypto.randomUUID();
                            isAuthReady = true;
                            fetchAndDisplayTasks();
                        }
                    }
                });
            } else {
                console.error("Firebase config not found. Running without persistence.");
                userId = crypto.randomUUID();
                isAuthReady = true;
                fetchAndDisplayTasks();
            }

            const initialTasks = [
                { id: 'task1', name: 'Soil Test - Get Down & Dirty', description: 'Grab 10-15 random soil samples (3-6" deep). Mix \'em up, dry \'em out, and send \'em to a lab. No cheating with those flimsy home kits!', dueDate: '2025-07-28', category: 'Prep', completed: false },
                { id: 'task2', name: 'Weed & Pest Recon - Spy on Your Foes', description: 'Identify those pesky weeds (dandelions, clover, crabgrass?!) and creepy crawlies (grubs?). Hand-pull any small-time offenders. Too hot for chemicals, so keep it chill.', dueDate: '2025-07-29', category: 'Prep', completed: false },
                { id: 'task3', name: 'Deep Watering - Hydrate Your Hunks', description: 'Give your lawn a good, long drink: 1-1.5 inches this week, ideally in one epic morning session. Encourage those roots to go deep, deep, deep!', dueDate: '2025-07-30', category: 'Prep', completed: false },
                { id: 'task4', name: 'Mower Blade Check - Sharp Dressed Lawn', description: 'Set your mower to a glorious 3-3.5 inches. Only ever trim off a third of the blade – no scalping! And seriously, sharpen those blades. Dull cuts are so last season.', dueDate: '2025-07-31', category: 'Prep', completed: false },
                { id: 'task5', name: 'Aeration & Dethatching - Let Your Lawn Breathe', description: 'Time to de-stress your lawn! Rent a core aerator to relieve compaction. If thatch is over 0.5 inches, dethatch. Do it when the soil is nicely moist – your lawn will thank you.', dueDate: '2025-08-20', category: 'Restore', completed: false },
                { id: 'task6', name: 'Overseeding - Fill \'er Up!', description: 'Right after aeration, spread that top-tier cool-season grass blend (think Kentucky Bluegrass, Perennial Ryegrass, Fescue). A light peat moss or straw cover, then daily sips of water until those baby blades sprout (10-14 days).', dueDate: '2025-08-25', category: 'Restore', completed: false },
                { id: 'task7', name: 'Starter Fertilizer - Power-Up for Tiny Roots', description: 'Apply a high-phosphorus starter fertilizer (like a 10-18-10). This is pure rocket fuel for those new roots, helping them anchor down strong before winter hits.', dueDate: '2025-08-25', category: 'Restore', completed: false },
                { id: 'task8', name: 'Fall Feast (Sept) - Nutrient Nirvana', description: 'Mid-September: time for a slow-release fertilizer. This feeds roots, setting your lawn up for winter resilience and a stunning spring debut.', dueDate: '2025-09-15', category: 'Maintain', completed: false },
                { id: 'task9', name: 'Weed War - Fall Edition', description: 'Spot-treat those stubborn broadleaf weeds in the fall. They\'re actively slurping up nutrients, so the herbicide will hit \'em where it hurts. No mercy!', dueDate: '2025-09-25', category: 'Maintain', completed: false },
                { id: 'task10', name: 'Grub Patrol - Bug Busters!', description: 'Keep an eye out for grub mischief. If you spot these root-munching villains, unleash Dylox for a quick knockout or bring in beneficial nematodes for a long-term, eco-friendly solution.', dueDate: '2025-09-01', category: 'Maintain', completed: false },
                { id: 'task11', name: 'Winterizer - Your Lawn\'s Last Meal', description: 'Early November: apply a final fall feeding (the "Winterizer"). This crucial meal fuels strong roots through winter, guaranteeing an early, vibrant green-up in spring. Think of it as a power nap!', dueDate: '2025-11-05', category: 'Maintain', completed: false },
                { id: 'task12', name: 'Spring Pre-Emergent - Crabgrass Counter-Attack', description: 'Next Spring (late Apr/early May): deploy your pre-emergent herbicide. This is your secret weapon against crabgrass – stops it before it even thinks about sprouting. (Just don\'t apply if you\'re seeding!)', dueDate: '2026-04-25', category: 'Maintain', completed: false },
                { id: 'task13', name: 'Spring Fertilization (Early) - Wake Up, Buttercup!', description: 'Next Spring (Feb-Apr): As your lawn stirs from its winter slumber, give it a slow-release fertilizer. It\'s like coffee for your grass – a gentle wake-up, not a caffeine jolt!', dueDate: '2026-03-15', category: 'Maintain', completed: false },
                { id: 'task14', name: 'Spring Fertilization (Late) - Keep the Party Going', description: 'Next Spring (Apr-Jun): Six to eight weeks after the first spring feeding, it\'s time for round two! Keep those good vibes (and nutrients) flowing for sustained growth.', dueDate: '2026-05-01', category: 'Maintain', completed: false },
                { id: 'task15', name: 'Summer Feeding - Summer Bod Prep (Optional)', description: 'Next Summer (late Jun/early Jul): Optional feeding if your lawn looks a little tired. Only if it\'s getting enough water though, otherwise, you\'ll just be giving it sunburn!', dueDate: '2026-07-01', category: 'Maintain', completed: false },
            ];

            async function fetchAndDisplayTasks() {
                if (!isAuthReady) {
                    return;
                }

                const tasksDocRef = doc(db, `artifacts/${appId}/users/${userId}/lawnData/tasks`);
                try {
                    const docSnap = await getDoc(tasksDocRef);
                    let currentTasks = [];
                    if (docSnap.exists() && docSnap.data().tasks) {
                        currentTasks = docSnap.data().tasks;
                    } else {
                        await setDoc(tasksDocRef, { tasks: initialTasks });
                        currentTasks = initialTasks;
                    }

                    onSnapshot(tasksDocRef, (doc) => {
                        const latestTasks = doc.data().tasks || [];
                        renderTasks(latestTasks);
                    }, (error) => {
                        console.error("Error listening to tasks:", error);
                        renderTasks(currentTasks);
                    });

                } catch (error) {
                    console.error("Error fetching or initializing tasks:", error);
                    renderTasks(initialTasks);
                }
            }

            async function updateTaskCompletion(taskId, completed) {
                if (!isAuthReady || !db || !userId || !appId) {
                    console.warn("Cannot update task: Firebase not ready or user ID missing.");
                    return;
                }
                const tasksDocRef = doc(db, `artifacts/${appId}/users/${userId}/lawnData/tasks`);
                try {
                    const docSnap = await getDoc(tasksDocRef);
                    if (docSnap.exists()) {
                        const currentTasks = docSnap.data().tasks;
                        const updatedTasks = currentTasks.map(task => {
                            if (task.id === taskId) {
                                return { ...task, completed: completed, completedDate: completed ? getTodayDateString() : '' };
                            }
                            return task;
                        });
                        await setDoc(tasksDocRef, { tasks: updatedTasks });
                    }
                } catch (error) {
                    console.error("Error updating task completion:", error);
                }
            }

            function renderTasks(tasks) {
                const todayTasksContainer = document.getElementById('today-tasks-list');
                const completedTasksContainer = document.getElementById('completed-tasks-list');
                todayTasksContainer.innerHTML = '';
                completedTasksContainer.innerHTML = '';

                const today = getTodayDateString();
                const funTips = [
                    "Why did the scarecrow win an award? Because he was outstanding in his field!",
                    "What do you call a sad strawberry? A blueberry!",
                    "My lawn looks like a putting green... if the putter was a lawnmower.",
                    "Why did the gardener quit? His soul isn't in it!",
                    "Don't worry, your lawn still loves you, even if it's currently throwing a tantrum.",
                    "Fact: A well-maintained lawn silently judges your neighbor's patchy efforts."
                ];
                const randomTip = funTips[Math.floor(Math.random() * funTips.length)];
                
                tasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

                tasks.forEach(task => {
                    if (!task.completed && task.dueDate === today) {
                        const taskElement = document.createElement('div');
                        taskElement.className = 'flex items-start bg-card-bg text-main-text p-4 rounded-xl shadow-md mb-3';
                        taskElement.innerHTML = `
                            <input type="checkbox" id="task-${task.id}" class="mt-1 mr-3 h-5 w-5 text-accent focus:ring-accent border-subtle-border rounded">
                            <div class="flex-1">
                                <label for="task-${task.id}" class="text-lg font-semibold text-accent">${task.name}</label>
                                <p class="text-sm text-secondary-text">${task.description}</p>
                                <span class="text-xs font-medium uppercase mt-1 px-2 py-1 rounded-full self-start ${getCategoryColor(task.category)}">${task.category}</span>
                                <p class="text-xs text-secondary-text mt-1">Due: ${task.dueDate}</p>
                            </div>
                        `;
                        todayTasksContainer.appendChild(taskElement);
                        taskElement.querySelector(`#task-${task.id}`).addEventListener('change', (e) => {
                            updateTaskCompletion(task.id, e.target.checked);
                        });
                    } else if (task.completed) {
                        const completedTaskElement = document.createElement('div');
                        completedTaskElement.className = 'flex items-start bg-sub-card-bg p-4 rounded-xl shadow-sm mb-3 line-through text-secondary-text';
                        completedTaskElement.innerHTML = `
                            <input type="checkbox" id="task-${task.id}" class="mt-1 mr-3 h-5 w-5 text-accent-dark focus:ring-accent-dark border-subtle-border rounded" checked disabled>
                            <div class="flex-1">
                                <label for="task-${task.id}" class="text-lg font-semibold">${task.name}</label>
                                <p class="text-sm">${task.description}</p>
                                <span class="text-xs font-medium uppercase mt-1 px-2 py-1 rounded-full self-start ${getCategoryColor(task.category)}">${task.category}</span>
                                <p class="text-xs mt-1">Completed: ${task.completedDate}</p>
                            </div>
                        `;
                        completedTasksContainer.appendChild(completedTaskElement);
                    }
                });

                if (todayTasksContainer.children.length === 0) {
                    todayTasksContainer.innerHTML = `<p class="text-secondary-text text-center py-4">No tasks scheduled for today. Time for some relaxation, or perhaps a sassy joke about gardening: "${randomTip}"</p>`;
                }
                if (completedTasksContainer.children.length === 0) {
                    completedTasksContainer.innerHTML = '<p class="text-secondary-text text-center py-4">No tasks completed yet. Get to it, superstar!</p>';
                }
            }
        });
    </script>
    <!-- Chosen Palette: Simple Monochromatic Dark -->
    <!-- Application Structure Plan: A task-oriented, chronological single-page application. The structure guides the user from understanding their local environment to executing a seasonal plan. It starts with a 'Today's Focus' for daily actionable tasks (with playful language), then to a 'Today's Weather & Watering Advice' section, a phased timeline ('Phase 1: Prep', 'Phase 2: Restoration', 'Phase 3: Maintenance'), followed by 'Past Tasks', a 'Soil Test Input' tool, and ending with a 'Tools & Products' checklist. This structure was chosen to make a dense report digestible and actionable, allowing users to focus on what needs to be done 'now' while still seeing the full picture and tracking progress. Interactions like tab-switching for seasons and expanding details for tasks prevent information overload, while checkboxes, a dedicated completed list, and dynamic weather/soil input enhance daily usability and personalization. -->
    <!-- Visualization & Content Choices:
        - Local Conditions: Goal: Inform. Method: Chart.js line (temp), doughnut (soil), and bar (nutrients) charts. Interaction: Hover tooltips. Justification: Visualizes complex data for quick understanding.
        - Today's Focus: Goal: Act. Method: HTML list with checkboxes. Interaction: Click to check off tasks, which updates persistence. Justification: Provides immediate, actionable steps for the current day, with a fun tone.
        - Today's Weather & Watering Advice: Goal: Inform/Advise. Method: HTML text display. Interaction: Dynamic text based on mocked weather. Justification: Provides real-time context for daily decisions.
        - Restoration Plan: Goal: Guide. Method: HTML/CSS vertical timeline/accordion. Interaction: Click to expand details. Justification: Breaks down the process into manageable, chronological steps.
        - Past Tasks: Goal: Track. Method: HTML list showing completed tasks. Interaction: View only. Justification: Allows users to review their progress over time.
        - Soil Test Input: Goal: Personalize/Inform. Method: HTML form inputs, HTML text output, Chart.js bar chart update. Interaction: User input, button click to generate recommendations and update chart. Justification: Allows users to tailor advice to their specific soil data and see its visual representation.
        - Tools/Products: Goal: Organize. Method: Filterable HTML grid. Interaction: Click buttons to filter. Justification: Helps users quickly find specific items they need.
        - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1A1A1A; /* Darkest background */
            color: #E0E0E0; /* Light text for main content */
        }
        header {
            background-color: #262626; /* Slightly lighter dark for header */
            border-bottom: 1px solid #333333; /* Darker border */
        }
        .tab-active {
            border-color: #60A5FA; /* Accent Blue */
            color: #60A5FA; /* Accent Blue */
            font-weight: 600;
        }
        .tab-inactive {
            border-color: transparent;
            color: #A3A3A3; /* Lighter gray for inactive tabs */
        }
        .task-card {
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.4), 0 1px 2px 0 rgba(0, 0, 0, 0.24); /* Darker shadow */
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.24);
        }
        .details-panel {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }
        .details-panel.open {
            max-height: 1000px;
            transition: max-height 0.7s ease-in;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Monochromatic Dark Palette */
        .bg-main-bg { background-color: #1A1A1A; } /* Body background */
        .bg-header-bg { background-color: #262626; } /* Header background */
        .bg-card-bg { background-color: #2D2D2D; } /* Main card background */
        .bg-sub-card-bg { background-color: #383838; } /* Nested/completed card background */

        .text-main-text { color: #E0E0E0; } /* Primary light text */
        .text-secondary-text { color: #A3A3A3; } /* Secondary lighter gray text */
        .text-accent { color: #60A5FA; } /* Accent blue for headings/active elements */
        .text-accent-dark { color: #3B82F6; } /* Darker accent blue for checkboxes/hover */
        .text-highlight { color: #FACC15; } /* Yellow for temperature highlight */

        .border-subtle-border { border-color: #4D4D4D; } /* Subtle border for inputs/divs */

        input:focus { border-color: #60A5FA; ring-color: #60A5FA; }

        .filter-btn {
            background-color: #383838; /* Sub-card bg for inactive */
            color: #E0E0E0; /* Main text color */
            border-radius: 9999px; /* Full rounded */
        }
        .filter-btn.bg-accent {
            background-color: #60A5FA; /* Accent blue for active */
            color: white;
        }
        .filter-btn:hover {
            background-color: #4D4D4D; /* Darker grey on hover for inactive */
        }
        .filter-btn.bg-accent:hover {
            background-color: #3B82F6; /* Darker blue on hover for active */
        }

        .product-card {
            background-color: #2D2D2D; /* Main card background */
            color: #E0E0E0;
            border-color: #4D4D4D; /* Subtle border */
        }
        .product-card .font-semibold { color: #60A5FA; } /* Product names in accent */
        .product-card .text-sm { color: #A3A3A3; }

        /* Phase Tabs - Equal Width & Responsive */
        .phase-tab {
            flex: 1;
            text-align: left;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            white-space: normal;
            border-radius: 0.5rem; /* Slightly rounded tabs */
        }
        @media (max-width: 767px) {
            .phase-tab {
                font-size: 0.75rem;
                padding-left: 0.25rem;
                padding-right: 0.25rem;
                margin-top: 0.25rem;
                flex-basis: calc(33.33% - 0.5rem); /* Approximately 3 tabs per row */
            }
        }
    </style>
</head>
<body class="antialiased bg-main-bg">

    <header class="shadow-sm sticky top-0 z-20 bg-header-bg">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div>
                    <h1 class="text-xl md:text-2xl font-bold text-accent">Lawn Restoration Plan</h1>
                    <p class="text-sm text-secondary-text">Arlington Heights, IL</p>
                </div>
                <nav class="hidden md:flex space-x-6">
                    <a href="#conditions" class="text-secondary-text hover:text-accent transition">Local Conditions</a>
                    <a href="#today-focus" class="text-secondary-text hover:text-accent transition">Today's Focus</a>
                    <a href="#weather-section" class="text-secondary-text hover:text-accent transition">Weather & Water</a>
                    <a href="#plan" class="text-secondary-text hover:text-accent transition">The Plan</a>
                    <a href="#past-tasks" class="text-secondary-text hover:text-accent transition">Past Tasks</a>
                    <a href="#soil-test-input" class="text-secondary-text hover:text-accent transition">Soil Test</a>
                    <a href="#tools" class="text-secondary-text hover:text-accent transition">Tools & Products</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <section id="today-focus" class="mb-12 md:mb-16 scroll-mt-20">
            <h3 class="text-2xl md:text-3xl font-bold text-left text-accent mb-8">Today's Focus</h3>
            <div class="bg-card-bg p-6 md:p-8 rounded-xl shadow-lg">
                <p class="text-secondary-text mb-6">Alright, lawn boss! Here are your missions for today. Check 'em off when you've conquered them. Your lawn isn't going to fabulous itself!</p>
                <div id="today-tasks-list" class="space-y-4">
                </div>
            </div>
        </section>

        <section id="weather-section" class="mb-12 md:mb-16 scroll-mt-20">
            <h3 class="text-2xl md:text-3xl font-bold text-left text-accent mb-8">Today's Weather & Watering Advice</h3>
            <div class="bg-card-bg p-6 md:p-8 rounded-xl shadow-lg">
                <p class="text-secondary-text mb-6">Let's check what Mother Nature has in store for your gorgeous greens! Your watering recommendations are based on this, so listen up. (Weather data is simulated for now.)</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                    <div class="text-center p-4 border border-subtle-border rounded-xl bg-sub-card-bg">
                        <h4 class="font-semibold text-xl text-main-text mb-2">Current Conditions</h4>
                        <p class="text-4xl font-bold text-highlight" id="current-temp">--°F</p>
                        <p class="text-lg text-main-text" id="feels-like">Feels like --°F</p>
                        <p class="text-md text-secondary-text" id="weather-condition">--</p>
                        <p class="text-sm text-secondary-text" id="precip-chance">Precip. Chance: --%</p>
                        <p class="text-sm text-secondary-text" id="humidity">Humidity: --%</p>
                    </div>
                    <div class="text-center p-4 border border-subtle-border rounded-xl bg-sub-card-bg">
                        <h4 class="font-semibold text-xl text-main-text mb-2">Watering Recommendation</h4>
                        <p id="watering-advice" class="text-lg text-main-text leading-relaxed">Checking weather...</p>
                        <p class="text-sm text-secondary-text mt-2">Remember: Your silty soil holds water like a boss. Don't drown your lawn, okay?</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="conditions" class="mb-12 md:mb-16 scroll-mt-20">
            <h3 class="text-2xl md:text-3xl font-bold text-left text-accent mb-8">Understanding Your Local Environment</h3>
            <div class="bg-card-bg p-6 md:p-8 rounded-xl shadow-lg">
                <p class="text-secondary-text mb-8">To truly master your lawn, you need to understand its battlefield: Arlington Heights' unique climate and soil. These insights are the secret sauce for a thriving lawn.</p>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 p-4 rounded-xl border border-subtle-border bg-sub-card-bg">
                        <h4 class="font-semibold text-lg text-center mb-2 text-main-text">Typical Soil Composition</h4>
                        <div class="chart-container">
                            <canvas id="soilCompositionChart"></canvas>
                        </div>
                    </div>
                    <div class="lg:col-span-1 p-4 rounded-xl border border-subtle-border bg-sub-card-bg">
                        <h4 class="font-semibold text-lg text-center mb-2 text-main-text">Average Monthly Temperatures (°F)</h4>
                         <div class="chart-container">
                            <canvas id="tempChart"></canvas>
                        </div>
                    </div>
                    <div class="lg:col-span-1 p-4 rounded-xl border border-subtle-border bg-sub-card-bg">
                        <h4 class="font-semibold text-lg text-center mb-2 text-main-text">Key Soil Nutrient Levels</h4>
                        <div class="chart-container">
                            <canvas id="nutrientChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="soil-test-input" class="mb-12 md:mb-16 scroll-mt-20">
            <h3 class="text-2xl md:text-3xl font-bold text-left text-accent mb-8">Enter Your Soil Test Results</h3>
            <div class="bg-card-bg p-6 md:p-8 rounded-xl shadow-lg max-w-2xl mx-auto">
                <p class="text-secondary-text mb-6">Got your lab results? Punch them in here for personalized, no-nonsense nutrient advice. Let's make that lawn pop!</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="ph-input" class="block text-sm font-medium text-secondary-text">Soil pH</label>
                        <input type="number" id="ph-input" step="0.1" min="4" max="9" value="7.2" class="mt-1 block w-full rounded-lg border-subtle-border bg-sub-card-bg text-main-text shadow-sm focus:border-accent focus:ring-accent sm:text-sm p-2">
                    </div>
                    <div>
                        <label for="phosphorus-input" class="block text-sm font-medium text-secondary-text">Phosphorus (ppm)</label>
                        <input type="number" id="phosphorus-input" step="0.1" min="0" value="35.5" class="mt-1 block w-full rounded-lg border-subtle-border bg-sub-card-bg text-main-text shadow-sm focus:border-accent focus:ring-accent sm:text-sm p-2">
                    </div>
                    <div>
                        <label for="potassium-input" class="block text-sm font-medium text-secondary-text">Potassium (ppm)</label>
                        <input type="number" id="potassium-input" step="0.1" min="0" value="215.5" class="mt-1 block w-full rounded-lg border-subtle-border bg-sub-card-bg text-main-text shadow-sm focus:border-accent focus:ring-accent sm:text-sm p-2">
                    </div>
                    <div>
                        <label for="calcium-input" class="block text-sm font-medium text-secondary-text">Calcium (ppm)</label>
                        <input type="number" id="calcium-input" step="0.1" min="0" value="2894.0" class="mt-1 block w-full rounded-lg border-subtle-border bg-sub-card-bg text-main-text shadow-sm focus:border-accent focus:ring-accent sm:text-sm p-2">
                    </div>
                    <div class="sm:col-span-2">
                        <label for="iron-input" class="block text-sm font-medium text-secondary-text">Iron (ppm)</label>
                        <input type="number" id="iron-input" step="0.1" min="0" value="150.5" class="mt-1 block w-full rounded-lg border-subtle-border bg-sub-card-bg text-main-text shadow-sm focus:border-accent focus:ring-accent sm:text-sm p-2">
                    </div>
                </div>
                <button id="get-soil-recommendations-btn" class="w-full bg-accent hover:bg-accent-dark text-white py-2 px-4 rounded-lg font-semibold transition">Get Recommendations</button>
                <div id="soil-recommendations-output" class="mt-6 p-4 bg-sub-card-bg border border-accent rounded-lg text-main-text hidden">
                </div>
            </div>
        </section>

        <section id="plan" class="mb-12 md:mb-16 scroll-mt-20">
            <h3 class="text-2xl md:text-3xl font-bold text-left text-accent mb-8">The Restoration Plan: A Seasonal Timeline</h3>
            <div class="w-full max-w-4xl mx-auto bg-card-bg p-6 md:p-8 rounded-xl shadow-lg">
                <div class="border-b border-subtle-border mb-6">
                    <nav class="-mb-px flex flex-wrap justify-center gap-x-1 md:space-x-4" aria-label="Tabs">
                        <button id="tab-phase1" class="phase-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-xs md:text-base">Phase 1: Prep (Late July - Early Aug)</button>
                        <button id="tab-phase2" class="phase-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-xs md:text-base">Phase 2: Restore (Mid-Aug - Sept)</button>
                        <button id="tab-phase3" class="phase-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-xs md:text-base">Phase 3: Maintain (Ongoing)</button>
                    </nav>
                </div>

                <div id="content-phase1" class="phase-content mt-8">
                    <div class="space-y-6">
                        <div class="task-card bg-sub-card-bg rounded-xl shadow-sm overflow-hidden">
                            <button class="w-full text-left p-5 flex justify-between items-center focus:outline-none" data-target="details-1">
                                <span class="text-lg font-semibold text-accent">1. Comprehensive Soil Testing</span>
                                <span class="text-2xl text-accent-dark transition-transform duration-300">&#9662;</span>
                            </button>
                            <div id="details-1" class="details-panel px-5 pb-5">
                                <p class="text-secondary-text mb-4">The cornerstone of this plan. A lab test reveals precise pH and nutrient levels, eliminating guesswork. Collect 10-15 random 3-6" samples, mix, dry, and send to a lab. Tailored treatments require accurate data.</p>
                                <div class="bg-sub-card-bg border border-accent p-3 rounded-lg text-sm text-main-text">
                                    <strong class="font-semibold">Why it's critical:</strong> Soil pH directly impacts nutrient absorption. Guessing means wasted time, money, and potentially harming your lawn.
                                </div>
                            </div>
                        </div>
                         <div class="task-card bg-sub-card-bg rounded-xl shadow-sm overflow-hidden">
                            <button class="w-full text-left p-5 flex justify-between items-center focus:outline-none" data-target="details-2">
                                <span class="text-lg font-semibold text-accent">2. Weed & Pest Identification</span>
                                <span class="text-2xl text-accent-dark transition-transform duration-300">&#9662;</span>
                            </button>
                            <div id="details-2" class="details-panel px-5 pb-5">
                                <p class="text-secondary-text mb-4">Identify those invaders (dandelion, clover, crabgrass?!) and any creepy crawlies (grubs?). Hand-pull any small-time offenders. Too hot for chemicals, so keep it chill.</p>
                                <div class="bg-sub-card-bg border border-accent p-3 rounded-lg text-sm text-main-text">
                                    <strong class="font-semibold">Key Strategy:</strong> Right now, it's about containment. Over-aggressive chemical use in summer just stresses your grass more. Patience, grasshopper.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="content-phase2" class="phase-content mt-8 hidden">
                    <div class="space-y-6">
                        <div class="task-card bg-sub-card-bg rounded-xl shadow-sm overflow-hidden">
                            <button class="w-full text-left p-5 flex justify-between items-center focus:outline-none" data-target="details-3">
                                <span class="text-lg font-semibold text-accent">1. Aeration & Dethatching</span>
                                <span class="text-2xl text-accent-dark transition-transform duration-300">&#9662;</span>
                            </button>
                            <div id="details-3" class="details-panel px-5 pb-5">
                                <p class="text-secondary-text mb-4">This is the restoration hot zone! In late August/September, rent a core aerator to de-compact your soil. This lets your lawn breathe and soak up water/nutrients. If thatch is over 0.5 inches, dethatch. Do it when the soil is nicely moist – your lawn will thank you.</p>
                                <div class="bg-sub-card-bg border border-accent p-3 rounded-lg text-sm text-main-text">
                                    <strong class="font-semibold">Pro Tip:</strong> Aerating before overseeding creates perfect little pockets for new seeds. It's like VIP seating for your baby grass!
                                </div>
                            </div>
                        </div>
                        <div class="task-card bg-sub-card-bg rounded-xl shadow-sm overflow-hidden">
                            <button class="w-full text-left p-5 flex justify-between items-center focus:outline-none" data-target="details-4">
                                <span class="text-lg font-semibold text-accent">2. Overseeding with a Quality Blend</span>
                                <span class="text-2xl text-accent-dark transition-transform duration-300">&#9662;</span>
                            </button>
                            <div id="details-4" class="details-panel px-5 pb-5">
                                <p class="text-secondary-text mb-4">Right after aeration, spread that premium cool-season grass blend. A mix of Kentucky Bluegrass, Perennial Ryegrass, and Fescue is your Northern Illinois dream team! Lightly cover with peat moss or straw, then water daily until sprouts appear (10-14 days).</p>
                                <div class="bg-sub-card-bg border border-accent p-3 rounded-lg text-sm text-main-text">
                                    <strong class="font-semibold">The Ideal Blend:</strong> <br>
                                    - <strong class="text-secondary-text">Kentucky Bluegrass:</strong> For luscious density & self-healing. <br>
                                    - <strong class="text-secondary-text">Perennial Ryegrass:</strong> For quick, show-off germination. <br>
                                    - <strong class="text-secondary-text">Fescue (Tall/Fine):</strong> For drought and shade superpowers.
                                </div>
                            </div>
                        </div>
                        <div class="task-card bg-sub-card-bg rounded-xl shadow-sm overflow-hidden">
                            <button class="w-full text-left p-5 flex justify-between items-center focus:outline-none" data-target="details-5">
                                <span class="text-lg font-semibold text-accent">3. Apply Starter Fertilizer</span>
                                <span class="text-2xl text-accent-dark transition-transform duration-300">&#9662;</span>
                            </button>
                            <div id="details-5" class="details-panel px-5 pb-5">
                                <p class="text-secondary-text mb-4">Fertilize with a starter formula while seeding. These have extra phosphorus – the secret ingredient for monster root growth. Give those baby roots the best head start before winter arrives!</p>
                                <div class="bg-sub-card-bg border border-accent p-3 rounded-lg text-sm text-main-text">
                                    <strong class="font-semibold">NPK Magic:</strong> Look for ratios like 10-18-10 or 18-24-12. That middle number (Phosphorus) is your roots' best friend.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="content-phase3" class="phase-content mt-8 hidden">
                    <div class="space-y-6">
                        <div class="task-card bg-sub-card-bg rounded-xl shadow-sm overflow-hidden">
                            <button class="w-full text-left p-5 flex justify-between items-center focus:outline-none" data-target="details-6">
                                <span class="text-lg font-semibold text-accent">Mowing & Watering Strategy</span>
                                <span class="text-2xl text-accent-dark transition-transform duration-300">&#9662;</span>
                            </button>
                            <div id="details-6" class="details-panel px-5 pb-5">
                                <p class="text-secondary-text mb-2"><strong class="font-semibold">Mowing:</strong> Keep it tall, 3-3.5 inches. Only ever cut a third of the blade – no extreme makeovers! Sharp blades = happy grass.</p>
                                <p class="text-secondary-text"><strong class="font-semibold">Watering:</strong> Go deep, go infrequent (1-1.5 inches/week). Morning is best. Your silty soil likes to hold water, so check before you soak.</p>
                            </div>
                        </div>
                        <div class="task-card bg-sub-card-bg rounded-xl shadow-sm overflow-hidden">
                            <button class="w-full text-left p-5 flex justify-between items-center focus:outline-none" data-target="details-7">
                                <span class="text-lg font-semibold text-accent">Annual Fertilization Schedule</span>
                                <span class="text-2xl text-accent-dark transition-transform duration-300">&#9662;</span>
                            </button>
                            <div id="details-7" class="details-panel px-5 pb-5">
                                <ul class="list-disc list-inside text-secondary-text space-y-2">
                                    <li><strong class="font-semibold">Early Spring (Feb-Apr):</strong> First feeding. Gentle wake-up call for your grass.</li>
                                    <li><strong class="font-semibold">Late Spring (Apr-Jun):</strong> Second feeding, 6-8 weeks later. Keep the good times rolling!</li>
                                    <li><strong class="font-semibold">Summer (Jun-Jul):</strong> Optional. Only if needed and if you can provide enough water – don't dry-fry your lawn!</li>
                                    <li><strong class="font-semibold text-accent">Fall (Sept & Nov):</strong> The Big Ones! "Winterizer" for superhero roots and next spring's award-winning green.</li>
                                </ul>
                            </div>
                        </div>
                        <div class="task-card bg-sub-card-bg rounded-xl shadow-sm overflow-hidden">
                            <button class="w-full text-left p-5 flex justify-between items-center focus:outline-none" data-target="details-8">
                                <span class="text-lg font-semibold text-accent">Integrated Pest & Weed Management</span>
                                <span class="text-2xl text-accent-dark transition-transform duration-300">&#9662;</span>
                            </button>
                            <div id="details-8" class="details-panel px-5 pb-5">
                                <p class="text-secondary-text mb-2"><strong class="font-semibold">Proactive (Pre-emergent):</strong> Spring (late Apr/early May) for crabgrass. Stops 'em before they start. (Don't apply if you're seeding, duh.)</p>
                                <p class="text-secondary-text"><strong class="font-semibold">Reactive (Post-emergent):</strong> Fall is prime time for existing broadleaf weeds. They're vulnerable then. Check for grubs in late summer and give 'em what for!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="past-tasks" class="mb-12 md:mb-16 scroll-mt-20">
            <h3 class="text-2xl md:text-3xl font-bold text-left text-accent mb-8">Past Tasks Completed</h3>
            <div class="bg-card-bg p-6 md:p-8 rounded-xl shadow-lg">
                <p class="text-secondary-text mb-6">Look at you, getting things done! Here's a glorious record of your lawn-conquering achievements. Pat yourself on the back, you earned it!</p>
                <div id="completed-tasks-list" class="space-y-4">
                </div>
            </div>
        </section>

        <section id="tools" class="scroll-mt-20">
            <h3 class="text-2xl md:text-3xl font-bold text-left text-accent mb-8">Tools & Products Checklist</h3>
            <div class="bg-card-bg p-6 md:p-8 rounded-xl shadow-lg">
                <div class="flex flex-wrap justify-start gap-2 mb-8">
                    <button class="filter-btn bg-accent text-white py-2 px-4 rounded-full text-sm font-semibold transition hover:bg-accent-dark">All</button>
                    <button class="filter-btn bg-sub-card-bg text-main-text py-2 px-4 rounded-full text-sm font-semibold transition hover:bg-sub-card-bg" data-filter="tool">Tools</button>
                    <button class="filter-btn bg-sub-card-bg text-main-text py-2 px-4 rounded-full text-sm font-semibold transition hover:bg-sub-card-bg" data-filter="seed">Seed</button>
                    <button class="filter-btn bg-sub-card-bg text-main-text py-2 px-4 rounded-full text-sm font-semibold transition hover:bg-sub-card-bg" data-filter="fertilizer">Fertilizers</button>
                    <button class="filter-btn bg-sub-card-bg text-main-text py-2 px-4 rounded-full text-sm font-semibold transition hover:bg-sub-card-bg" data-filter="control">Weed/Pest Control</button>
                </div>
                <div id="product-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    </div>
            </div>
        </section>

    </main>

    <footer class="bg-header-bg mt-16">
        <div class="container mx-auto px-8 py-6 text-center text-secondary-text">
            <p>&copy; 2024 Interactive Lawn Plan. Information sourced from the Comprehensive Lawn Restoration Report.</p>
        </div>
    </footer>

    <script>
        function getCategoryColor(category) {
            switch (category) {
                case 'tool': return 'bg-gray-700 text-gray-200';
                case 'seed': return 'bg-blue-700 text-blue-100';
                case 'fertilizer': return 'bg-green-700 text-green-100';
                case 'control': return 'bg-red-700 text-red-100';
                case 'Prep': return 'bg-purple-700 text-purple-100';
                case 'Restore': return 'bg-orange-700 text-orange-100';
                case 'Maintain': return 'bg-teal-700 text-teal-100';
                default: return 'bg-gray-600 text-gray-200';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const productData = [
                { name: 'Lab-based Soil Test Kit', category: 'tool', desc: 'For precise pH and nutrient analysis. No more guessing games!' },
                { name: 'Broadcast or Drop Spreader', category: 'tool', desc: 'Ensures your seed and fertilizer hit every spot, perfectly.' },
                { name: 'Core Aerator', category: 'tool', desc: 'Rent one, or hire a pro. This tool helps your lawn breathe.' },
                { name: 'Dethatcher', category: 'tool', desc: 'Removes gunk (thatch) that chokes your grass. Get it out!' },
                { name: 'Lawn Mower (Sharp Blades)', category: 'tool', desc: 'A clean cut is a happy cut. Keep those blades razor-sharp!' },
                { name: 'Garden Rake', category: 'tool', desc: 'Your trusty sidekick for seed prep and spreading magic.' },
                { name: 'Cool-Season Grass Blend', category: 'seed', desc: 'The dream team: Kentucky Bluegrass, Perennial Ryegrass, and Fescue for a lush, resilient lawn.' },
                { name: 'Starter Fertilizer', category: 'fertilizer', desc: 'High-phosphorus formula for baby roots. Think of it as protein shake for sprouts.' },
                { name: 'Fall or Winterizer Fertilizer', category: 'fertilizer', desc: 'High-potassium goodness for winter survival and a spring explosion.' },
                { name: 'Spring or Summer Fertilizer', category: 'fertilizer', desc: 'Seasonal boosts for when your lawn needs an extra kick.' },
                { name: 'Post-Emergent Broadleaf Herbicide', category: 'control', desc: 'Targets existing broadleaf invaders. Apply with precision, then watch \'em wilt.' },
                { name: 'Pre-Emergent Herbicide', category: 'control', desc: 'Your secret weapon against crabgrass. Stops it before it even thinks about sprouting. (Just don\'t apply if you\'re seeding!)' },
                { name: 'Grub Control Product', category: 'control', desc: 'For when tiny monsters attack. Immediate (Dylox) or long-term (Nematodes) solutions.' },
                { name: 'Peat Moss or Straw', category: 'seed', desc: 'A cozy blanket for your new seeds, keeping them moist and safe.' },
            ];

            const productGrid = document.getElementById('product-grid');
            const filterBtns = document.querySelectorAll('.filter-btn');

            function renderProducts(filter) {
                productGrid.innerHTML = '';
                const filteredProducts = filter === 'all' ? productData : productData.filter(p => p.category === filter);
                
                filteredProducts.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'product-card border rounded-xl p-4 flex flex-col justify-between bg-card-bg';
                    card.innerHTML = `
                        <div>
                            <p class="font-semibold text-accent">${product.name}</p>
                            <p class="text-sm text-secondary-text">${product.desc}</p>
                        </div>
                        <span class="text-xs font-medium uppercase mt-3 px-2 py-1 rounded-full self-start ${getCategoryColor(product.category)}">${product.category}</span>
                    `;
                    productGrid.appendChild(card);
                });
            }

            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => {
                        b.classList.remove('bg-accent', 'text-white');
                        b.classList.add('bg-sub-card-bg', 'text-main-text');
                    });
                    btn.classList.add('bg-accent', 'text-white');
                    btn.classList.remove('bg-sub-card-bg', 'text-main-text');
                    renderProducts(btn.dataset.filter);
                });
            });

            renderProducts('all');
            
            const phaseTabs = document.querySelectorAll('.phase-tab');
            const phaseContents = document.querySelectorAll('.phase-content');

            phaseTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    phaseTabs.forEach(t => {
                        t.classList.remove('tab-active');
                        t.classList.add('tab-inactive');
                    });
                    tab.classList.add('tab-active');
                    tab.classList.remove('tab-inactive');
                    
                    const targetId = 'content-' + tab.id.split('-')[1];
                    phaseContents.forEach(content => {
                        if (content.id === targetId) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });

            document.getElementById('tab-phase1').classList.add('tab-active');
            document.getElementById('tab-phase1').classList.remove('tab-inactive');

            const accordionButtons = document.querySelectorAll('.task-card button');
            accordionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const detailsPanel = document.getElementById(button.dataset.target);
                    const arrow = button.querySelector('span:last-child');
                    
                    if (detailsPanel.classList.contains('open')) {
                        detailsPanel.classList.remove('open');
                        arrow.style.transform = 'rotate(0deg)';
                    } else {
                        document.querySelectorAll('.details-panel.open').forEach(openPanel => {
                            openPanel.classList.remove('open');
                            openPanel.previousElementSibling.querySelector('span:last-child').style.transform = 'rotate(0deg)';
                        });
                        detailsPanel.classList.add('open');
                        arrow.style.transform = 'rotate(180deg)';
                    }
                });
            });

            initializeCharts();
            displayWeatherAndWatering();
            setupSoilTestInput();

            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
        });

        function initializeCharts() {
            const soilCtx = document.getElementById('soilCompositionChart').getContext('2d');
            new Chart(soilCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Silt', 'Clay', 'Sand'],
                    datasets: [{
                        label: 'Soil Composition',
                        data: [63, 23, 14],
                        backgroundColor: ['#60A5FA', '#3B82F6', '#60A5FA'], /* Accent blue shades for soil */
                        borderColor: '#1A1A1A', /* Match body background */
                        borderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#A3A3A3' }, position: 'bottom' }, /* Secondary text legend */
                        tooltip: { callbacks: { label: (context) => `${context.label}: ${context.raw}%` } }
                    }
                }
            });

            const tempCtx = document.getElementById('tempChart').getContext('2d');
            new Chart(tempCtx, {
                type: 'line',
                data: {
                    labels: ['May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'],
                    datasets: [{
                        label: 'Avg High Temp',
                        data: [74, 81, 84, 82, 75, 63],
                        borderColor: '#60A5FA', /* Accent Blue for high temp */
                        backgroundColor: 'rgba(96, 165, 250, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Avg Low Temp',
                        data: [52, 61, 65, 63, 55, 44],
                        borderColor: '#A3A3A3', /* Secondary text color for low temp */
                        backgroundColor: 'rgba(163, 163, 163, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#A3A3A3' }, position: 'bottom' } }, /* Secondary text legend */
                    scales: {
                        x: { ticks: { color: '#A3A3A3' }, grid: { color: '#4D4D4D' } }, /* Secondary ticks, subtle border grid */
                        y: { ticks: { color: '#A3A3A3', callback: (value) => `${value}°F` }, grid: { color: '#4D4D4D' } } /* Secondary ticks, subtle border grid */
                    }
                }
            });

            const nutrientCtx = document.getElementById('nutrientChart').getContext('2d');
            nutrientChartInstance = new Chart(nutrientCtx, {
                type: 'bar',
                data: {
                    labels: ['Phosphorus', 'Potassium', 'Calcium', 'Iron'],
                    datasets: [{
                        label: 'Nutrient Level (ppm)',
                        data: [35.5, 215.5, 2894.0, 150.5],
                        backgroundColor: ['#60A5FA', '#3B82F6', '#60A5FA', '#3B82F6'], /* Accent blue shades for nutrients */
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: {
                            ticks: { color: '#A3A3A3',
                                callback: function(value, index, values) {
                                    if (value === 10 || value === 100 || value === 1000 || value === 3000) {
                                        return value.toString();
                                    }
                                }
                            },
                            grid: { color: '#4D4D4D' } /* Subtle border grid */
                        },
                        y: {
                            ticks: { color: '#A3A3A3' }, /* Secondary ticks */
                            grid: { color: '#4D4D4D' } /* Subtle border grid */
                        }
                    }
                }
            });
        }

        async function displayWeatherAndWatering() {
            const mockWeather = {
                current_conditions: {
                    temperature: "87°F",
                    feels_like_temperature: "96°F",
                    current_weather_conditions: "partly cloudy",
                    precipitation: { chance: "0%" },
                    humidity: "63%"
                },
                daily_forecasts: [
                    {
                        forecast_day: `Sunday, July 27, 2025 (today)`,
                        high_temperature: "88°F",
                        day_time_precipitation: { chance: "45%" }
                    }
                ]
            };

            document.getElementById('current-temp').textContent = mockWeather.current_conditions.temperature;
            document.getElementById('feels-like').textContent = `Feels like ${mockWeather.current_conditions.feels_like_temperature}`;
            document.getElementById('weather-condition').textContent = mockWeather.current_conditions.current_weather_conditions;
            document.getElementById('precip-chance').textContent = `Precip. Chance: ${mockWeather.daily_forecasts[0].day_time_precipitation.chance}`;
            document.getElementById('humidity').textContent = `Humidity: ${mockWeather.current_conditions.humidity}`;

            const currentTemp = parseFloat(mockWeather.current_conditions.temperature.replace('°F', ''));
            const precipChance = parseFloat(mockWeather.daily_forecasts[0].day_time_precipitation.chance.replace('%', ''));
            
            document.getElementById('watering-advice').textContent = getWateringRecommendation(currentTemp, precipChance);
        }

        function getWateringRecommendation(currentTemp, precipChance) {
            if (precipChance >= 40) {
                return "Rain's on the forecast! Skip the sprinklers. But seriously, check that soil after the downpour – your silty turf drinks smart.";
            } else if (currentTemp >= 85) {
                return "It's a scorcher! Your lawn's probably sweating. If it's feeling thirsty, give it a deep drink, but don't overdo it. That silty soil holds on tight to moisture!";
            } else {
                return "No drama today. Water deeply (1-1.5 inches/week) but don't babysit it with daily sprinkles. Early mornings are best, and let that topsoil dry out a bit.";
            }
        }

        function setupSoilTestInput() {
            const phInput = document.getElementById('ph-input');
            const phosphorusInput = document.getElementById('phosphorus-input');
            const potassiumInput = document.getElementById('potassium-input');
            const calciumInput = document.getElementById('calcium-input');
            const ironInput = document.getElementById('iron-input');
            const getRecommendationsBtn = document.getElementById('get-soil-recommendations-btn');
            const recommendationsOutput = document.getElementById('soil-recommendations-output');

            getRecommendationsBtn.addEventListener('click', () => {
                const ph = parseFloat(phInput.value);
                const phosphorus = parseFloat(phosphorusInput.value);
                const potassium = parseFloat(potassiumInput.value);
                const calcium = parseFloat(calciumInput.value);
                const iron = parseFloat(ironInput.value);

                const recommendations = generateSoilRecommendations(ph, phosphorus, potassium, calcium, iron);
                recommendationsOutput.innerHTML = recommendations.join('<br>');
                recommendationsOutput.classList.remove('hidden');

                if (nutrientChartInstance) {
                    nutrientChartInstance.data.datasets[0].data = [phosphorus, potassium, calcium, iron];
                    nutrientChartInstance.update();
                }
            });
        }

        function generateSoilRecommendations(ph, p, k, ca, fe) {
            const recs = [];

            recs.push('<strong>Soil Test Recommendations:</strong>');

            if (ph > 7.5) {
                recs.push(`Your soil pH (${ph}) is a bit high. Some nutrients might be playing hard to get. Focus on proper feeding, as drastic pH changes are tough here.`);
            } else if (ph < 6.0) {
                recs.push(`Your soil pH (${ph}) is low. Time for some lime to balance things out. Chat with a local expert for the right dose!`);
            } else {
                recs.push(`Your soil pH (${ph}) is spot on! Keep up the good work with balanced feeding.`);
            }

            if (p < 20) {
                recs.push(`Phosphorus (${p} ppm) is low. Your roots are hungry! Give them a starter fertilizer (high P, like 10-18-10).`);
            } else if (p > 50) {
                recs.push(`Phosphorus (${p} ppm) is high. Lay off the P-heavy stuff to protect our waterways and avoid imbalances.`);
            } else {
                recs.push(`Phosphorus (${p} ppm) is just right. Keep it balanced, superstar!`);
            }

            if (k < 120) {
                recs.push(`Potassium (${k} ppm) is low. Boost its stress resistance with a balanced fertilizer or a winterizer. Make it tough!`);
            } else if (k > 250) {
                 recs.push(`Potassium (${k} ppm) is super high. You're set! No extra K needed, just monitor.`);
            } else {
                recs.push(`Potassium (${k} ppm) is happy. Continue with your balanced feeding routine.`);
            }

            if (ca < 1000) {
                recs.push(`Calcium (${ca} ppm) is low. Consider gypsum if your soil feels a bit chunky. It helps with structure and drainage.`);
            } else {
                recs.push(`Calcium (${ca} ppm) is perfectly fine. You're doing great!`);
            }

            if (fe < 50) {
                recs.push(`Iron (${fe} ppm) is low. Want a deeper green? An iron supplement might be your ticket, especially if pH is high.`);
            } else {
                recs.push(`Iron (${fe} ppm) is golden! Expect vibrant color.`);
            }

            return recs;
        }
    </script>
</body>
</html>
